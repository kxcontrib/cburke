<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <title>Build hdb</title>
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <style>body {margin: 1em 5% 1em 5%}
  b,code,pre,tt {color:#000080}
  pre {background:#fffaf4; border:1pt solid #aebdcc; padding:5pt}
  h1,h2,h3 {color:#015293;font-family:sans-serif;border-bottom:2px solid silver;
  margin-top:1.2em;margin-bottom:0.5em;line-height:1.3}
  </style>
</head>
<body>
<header>
<h1 class="title">Build hdb</h1>
</header>
<p>The script buildhdb.q builds a small historical database, useful when learning q. The main tables are partitioned on date, and optionally segmented on a round robin basis.</p>
<p>Prices and sizes are generated by random walks, selecting those that do not wander too far from outset. Prices are correlated.</p>
<p>There are 15 stocks. If you change this, also change corresponding definitions of starting prices, etc.</p>
<p>Take care to ensure that the target folders are empty and writable. With the default configuration, you may need to create the start subdirectory.</p>
<h2 id="default-hdb">Default hdb</h2>
<p>The first few lines are the configuration, modify as needed:</p>
<pre><code>dst:`:start/db      / database root (relative to q directory)
dsp:&quot;&quot;              / optional database segments root
dsx:5               / number of segments
bgn:2013.05.01      / begin, end
end:2013.05.31      / (only mon-fri used)
nt:1000             / trades per stock per day
qpt:5               / quotes per trade
npt:3               / nbbo per trade
nl2:1000            / level II entries in day
\S 104831           / random seed</code></pre>
<p>With the default config, the database generated will be about 100MB, with about 2 million trades and quotes (these values depend on the random seed).</p>
<h2 id="segmented-hdb">Segmented hdb</h2>
<p>The database can be segmented. Usually this would be done over different drives, but for illustration, the segments are here written to the same drive. The database segment directory needs to be defined. For the segmented database, try changing the data to 4 year's worth, for example:</p>
<pre><code>dst:`:start/dbs     / new database root
dsp:`:/dbss         / database segments root
bgn:2010.01.01      / begin, end
end:2013.12.31      / 4 years</code></pre>
<p>This writes the daily data to folders <code>/dbss/d0</code>, <code>/dbss/d1</code>, etc. and creates <code>par.txt</code> in the database root.</p>
<p>With this config, the database generated will be about 4GB, with about 75 million trades and quotes (these values depend on the random seed).</p>
<h2 id="tables">Tables</h2>
<p>The tables are:</p>
<ul>
<li>daily - daily open/high/low/close</li>
<li>depth - last day depth of book</li>
<li>mas - stock name master</li>
<li>nbbo - best bid/offer</li>
<li>quote - quotes</li>
<li>trade - trades</li>
</ul>
<p>For example:</p>
<pre><code>q)\l start/db
q)count quote
1846241
q)3#select from quote where date=last date, sym=`IBM
date       sym time         bid   ask   bsize asize mode ex
-----------------------------------------------------------
2013.05.31 IBM 09:30:00.004 47.12 48.01 21    72    O    N
2013.05.31 IBM 09:30:00.008 46.98 48.14 93    17    Z    N
2013.05.31 IBM 09:30:00.013 47.22 47.99 55    19    A    N</code></pre>
<hr>
<p>cdb<br/> 17 Oct 2013</p>
</body>
</html>
